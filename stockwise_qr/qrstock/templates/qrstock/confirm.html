<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Confirm Stock Addition</title>
  <style>
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; padding:16px;}
    .card{max-width:520px; margin:0 auto; background:#fff; border:1px solid #eee; border-radius:12px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,0.05)}
    h1{font-size:1.25rem; margin:0 0 12px}
    .muted{color:#666; font-size:0.95rem}
    .row{margin:8px 0}
    .label{color:#555}
    input[type=number]{width:100%; padding:10px; font-size:1rem; border:1px solid #ddd; border-radius:8px}
    button{width:100%; padding:12px; font-size:1rem; border:none; border-radius:8px; background:#d32f2f; color:#fff; cursor:pointer; box-sizing:border-box; min-height:48px; touch-action:manipulation}
    button:disabled{opacity:.6; cursor:not-allowed}
    button:hover{opacity:0.9}
    button:active{transform:scale(0.98)}
    .ok{background:#2e7d32}
    .msg{margin-top:10px; font-size:.95rem; padding:8px; border-radius:4px; text-align:center}
    .success{background:#e8f5e8; color:#2e7d32; border:1px solid #4caf50}
    .error{background:#ffebee; color:#c62828; border:1px solid #f44336}
  </style>
  <script>
    async function confirmAdd(e){
      e.preventDefault();
      const form = document.getElementById('f');
      const button = form.querySelector('button[type="submit"]');
      const msg = document.getElementById('msg');
      
      // Disable button and show loading
      button.disabled = true;
      button.textContent = 'Adding Stock...';
      msg.textContent = '';
      msg.className = 'msg';
      
      try {
        const fd = new FormData(form);
        const res = await fetch(window.location.href, {method:'POST', body: fd});
        const data = await res.json();
        
        if(data.success){
          msg.textContent = '✅ Stock added successfully!';
          msg.className = 'msg success';
          // Reset form after success
          form.reset();
        } else {
          msg.textContent = '❌ ' + (data.message || 'Failed to add stock');
          msg.className = 'msg error';
        }
      } catch(error) {
        msg.textContent = '❌ Network error. Please try again.';
        msg.className = 'msg error';
      } finally {
        // Re-enable button
        button.disabled = false;
        button.textContent = 'Confirm Addition';
      }
    }
  </script>
  <meta name="color-scheme" content="light dark">
</head>
<body>
  <div class="card">
    <h1>Confirm Add Stock</h1>
    <div class="row"><span class="label">Product:</span> <strong>{{ product.name }}</strong></div>
    <div class="row"><span class="label">Size:</span> {{ product.size|default:'N/A' }}</div>
    <div class="row"><span class="label">Delivery date:</span> {{ delivery_date }}</div>
    <div class="row"><span class="label">Batch ID:</span> <code>{{ batch_id }}</code></div>
    <form id="f" method="post" onsubmit="confirmAdd(event)">
      {% csrf_token %}
      <div class="row">
        <label for="q" class="label">Quantity to add</label>
        <input id="q" type="number" min="1" name="quantity" required />
      </div>
      <div class="row">
        <label for="s" class="label">Supplier name (optional)</label>
        <input id="s" type="text" name="supplier" placeholder="Enter supplier name if available" />
      </div>
      <div class="row">
        <button type="submit" class="ok">Confirm Addition</button>
      </div>
    </form>
    <div id="msg" class="msg"></div>
    <p class="muted">Scanning this QR lets you add stock for the specific batch (FIFO).</p>
  </div>
</body>
<!-- Minimal, mobile-friendly page so staff can add stock via phone -->
</html>


